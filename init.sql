ALTER USER 'root' IDENTIFIED WITH mysql_native_password BY 'password';
flush privileges;

CREATE TABLE ALBUMS(
    ALBUM_ID int AUTO_INCREMENT PRIMARY KEY,
    ALBUM_NAME varchar(128) NOT NULL,
    RELEASE_DATE date NOT NULL
);
CREATE TABLE ARTISTS(
    ARTIST_ID int AUTO_INCREMENT PRIMARY KEY,
    ARTIST_NAME varchar(128) NOT NULL
);
CREATE TABLE GENRES(
    GENRE_ID int AUTO_INCREMENT PRIMARY KEY,
	GENRE_NAME varchar(128) NOT NULL
);
CREATE TABLE SONGS(
    SONG_ID int AUTO_INCREMENT PRIMARY KEY,
    SONG_NAME varchar(128) NOT NULL,
    LENGTH int NOT NULL,
    ALBUM_ID int NULL,
    LISTEN_COUNT int NOT NULL,
    RELEASE_DATE date NOT NULL,
    FOREIGN KEY (ALBUM_ID) REFERENCES ALBUMS(ALBUM_ID)
);
CREATE TABLE USERS(
    USER_ID int AUTO_INCREMENT PRIMARY KEY,
    USERNAME varchar(128) NOT NULL,
    FIRST_NAME varchar(128) NOT NULL,
    LAST_NAME varchar(128) NOT NULL
);
CREATE TABLE PLAYLISTS(
    PLAYLIST_ID int AUTO_INCREMENT PRIMARY KEY,
    PLAYLIST_AUTHOR int NOT NULL,
    PLAYLIST_NAME varchar(128) NOT NULL,
    CREATION_DATE date NOT NULL,
    FOREIGN KEY (PLAYLIST_AUTHOR) REFERENCES USERS(USER_ID)
);

CREATE TABLE ALBUM_ARTISTS(
    ALBUM_ID int,
    ARTIST_ID int,
    PRIMARY KEY(ALBUM_ID,ARTIST_ID),
    FOREIGN KEY (ALBUM_ID) REFERENCES ALBUMS(ALBUM_ID),
    FOREIGN KEY (ARTIST_ID) REFERENCES ARTISTS(ARTIST_ID)
);
CREATE TABLE SONG_ARTISTS(
    SONG_ID int,
    ARTIST_ID int,
    PRIMARY KEY(SONG_ID,ARTIST_ID),
    FOREIGN KEY (SONG_ID) REFERENCES SONGS(SONG_ID),
    FOREIGN KEY (ARTIST_ID) REFERENCES ARTISTS(ARTIST_ID)
);
CREATE TABLE ALBUM_GENRES(
    ALBUM_ID int,
    GENRE_ID int,
    PRIMARY KEY(ALBUM_ID,GENRE_ID),
    FOREIGN KEY (ALBUM_ID) REFERENCES ALBUMS(ALBUM_ID),
    FOREIGN KEY (GENRE_ID) REFERENCES GENRES(GENRE_ID)
);
CREATE TABLE SONG_GENRES(
    SONG_ID int,
    GENRE_ID int,
    PRIMARY KEY(SONG_ID,GENRE_ID),
    FOREIGN KEY (SONG_ID) REFERENCES SONGS(SONG_ID),
    FOREIGN KEY (GENRE_ID) REFERENCES GENRES(GENRE_ID)
);
CREATE TABLE PLAYLIST_SONGS(
    PLAYLIST_ID int,
    SONG_ID int,
    PRIMARY KEY(PLAYLIST_ID,SONG_ID),
    FOREIGN KEY (PLAYLIST_ID) REFERENCES PLAYLISTS(PLAYLIST_ID),
    FOREIGN KEY (SONG_ID) REFERENCES SONGS(SONG_ID)
);

CREATE VIEW DISCOGRAPHYVIEW AS
SELECT DISTINCT
    SONGS.SONG_ID,
    SONGS.SONG_NAME,
    SONGS.RELEASE_DATE,
    ARTISTS.ARTIST_ID,
    ALBUMS.ALBUM_NAME,
    GROUP_CONCAT(DISTINCT GENRES.GENRE_NAME SEPARATOR ', ') AS GENRE_NAMES
FROM SONGS
LEFT JOIN SONG_ARTISTS ON SONGS.SONG_ID = SONG_ARTISTS.SONG_ID
LEFT JOIN ARTISTS ON SONG_ARTISTS.ARTIST_ID = ARTISTS.ARTIST_ID
LEFT JOIN ALBUMS ON ALBUMS.ALBUM_ID = SONGS.ALBUM_ID
LEFT JOIN SONG_GENRES ON SONGS.SONG_ID = SONG_GENRES.SONG_ID
LEFT JOIN GENRES ON SONG_GENRES.GENRE_ID = GENRES.GENRE_ID
GROUP BY 
    SONGS.SONG_ID,
    SONGS.SONG_NAME,
    SONGS.RELEASE_DATE,
    ARTISTS.ARTIST_ID,
    ALBUMS.ALBUM_NAME;

CREATE VIEW ARTISTMOSTPOPULARVIEW AS
SELECT DISTINCT
    SONGS.SONG_ID,
    SONGS.SONG_NAME,
    SONGS.LISTEN_COUNT,
    SONGS.RELEASE_DATE,
    ARTISTS.ARTIST_ID
FROM SONGS
JOIN SONG_ARTISTS ON SONGS.SONG_ID = SONG_ARTISTS.SONG_ID
JOIN ARTISTS ON SONG_ARTISTS.ARTIST_ID = ARTISTS.ARTIST_ID
ORDER BY LISTEN_COUNT DESC;

CREATE VIEW PLAYLISTINFOVIEW AS 
SELECT DISTINCT
    PLAYLIST_ID,     
    PLAYLIST_AUTHOR AS AUTHOR_ID, 
    PLAYLIST_NAME,   
    CREATION_DATE,   
    USERS.USERNAME AS AUTHOR_NAME
FROM
    PLAYLISTS
    JOIN USERS ON USERS.USER_ID=PLAYLIST_AUTHOR;

CREATE VIEW PLAYLISTSONGVIEW AS
SELECT DISTINCT
    PLAYLISTS.PLAYLIST_ID,
	PLAYLISTS.PLAYLIST_NAME,
    USERS.USERNAME AS PLAYLIST_AUTHOR,
    PLAYLISTS.CREATION_DATE,
    ALBUMS.ALBUM_NAME,
    SONGS.SONG_NAME,
    SONGS.LENGTH
FROM
	PLAYLISTS
JOIN USERS ON PLAYLISTS.PLAYLIST_AUTHOR = USERS.USER_ID
JOIN PLAYLIST_SONGS ON PLAYLISTS.PLAYLIST_ID = PLAYLIST_SONGS.PLAYLIST_ID
JOIN SONGS ON PLAYLIST_SONGS.SONG_ID = SONGS.SONG_ID
LEFT JOIN ALBUMS ON SONGS.ALBUM_ID = ALBUMS.ALBUM_ID;

CREATE VIEW ALBUMINFOVIEW AS 
SELECT DISTINCT
    ALBUMS.ALBUM_ID,
    ALBUMS.RELEASE_DATE,
    ALBUMS.ALBUM_NAME,
    GROUP_CONCAT(DISTINCT GENRES.GENRE_NAME SEPARATOR ', ') AS GENRE_NAMES,
    GROUP_CONCAT(DISTINCT ARTISTS.ARTIST_NAME SEPARATOR ', ') AS ARTIST_NAMES
      FROM ALBUMS 
    LEFT JOIN ALBUM_ARTISTS ON ALBUMS.ALBUM_ID = ALBUM_ARTISTS.ALBUM_ID
    LEFT JOIN ARTISTS ON ALBUM_ARTISTS.ARTIST_ID = ARTISTS.ARTIST_ID
    LEFT JOIN ALBUM_GENRES ON ALBUMS.ALBUM_ID = ALBUM_GENRES.ALBUM_ID
    LEFT JOIN GENRES ON GENRES.GENRE_ID=ALBUM_GENRES.GENRE_ID
  GROUP BY 
    ALBUMS.ALBUM_ID,
    ALBUMS.RELEASE_DATE,
    ALBUMS.ALBUM_NAME;

CREATE VIEW ALBUMSONGSVIEW AS
SELECT
    ALBUMS.ALBUM_ID,
    SONGS.SONG_ID,
    SONGS.SONG_NAME,
    SONGS.LISTEN_COUNT,
    SONGS.LENGTH,
    ALBUMS.RELEASE_DATE,
    GROUP_CONCAT(DISTINCT ARTISTS.ARTIST_NAME SEPARATOR ', ') AS ARTIST_NAMES
FROM SONGS
JOIN SONG_ARTISTS ON SONGS.SONG_ID = SONG_ARTISTS.SONG_ID
JOIN ARTISTS ON SONG_ARTISTS.ARTIST_ID = ARTISTS.ARTIST_ID
JOIN ALBUMS ON SONGS.ALBUM_ID = ALBUMS.ALBUM_ID
GROUP BY
    ALBUMS.ALBUM_ID,
    ALBUMS.ALBUM_NAME,
    SONGS.SONG_ID,
    SONGS.SONG_NAME,
    SONGS.LISTEN_COUNT,
    SONGS.LENGTH,
    ALBUMS.RELEASE_DATE;


    INSERT INTO ARTISTS (ARTIST_NAME) VALUES
    ('TWICE'), -- 1
    ('K/DA'), -- 2
    ('Seraphine'), -- 3
    ('(G)-IDLE'); -- 4

INSERT INTO ALBUMS (ALBUM_NAME, RELEASE_DATE)
VALUES
    ('ALL OUT', '2020-11-06'), -- 1
    ('Formula of Love: O+T=<3', '2021-11-12'), -- 2
    ('BETWEEN 1&2', '2022-08-26'), -- 3
    ('I NEVER DIE', '2022-03-14'); -- 4

INSERT INTO GENRES (GENRE_NAME) 
VALUES
    ('Disco-Pop'), -- 1
    ('Synth-Pop'), -- 2
    ('K-pop'), -- 3
    ('Pop'), -- 4
    ('Alternative Rock'), -- 5
    ('Contemporary R&B'), -- 6
    ('Hip Hop'), -- 7
    ('Dance-Pop'), -- 8
    ('Deep House'), -- 9
    ('Soul'), -- 10
    ('Ballad'), -- 11
    ('City-Pop'), -- 12
    ('Trap'), -- 13
    ('Reggae-Pop'), -- 14
    ('Bubblegum'), -- 15
    ('Pop punk'), -- 16
    ('Nu-disco'), -- 17
    ('Funk'), -- 18
    ('Atlanta bass'), -- 19
    ('House'), -- 20
    ('Future Bass'), -- 21
    ('Electro-pop'), -- 22
    ('Rock'), -- 23
    ('Soft-R&B'), -- 24
    ('Classic Rock'), -- 25
    ('EDM'), -- 26
    ('Power Ballad'), -- 27
    ('Indie-pop'), -- 28
    ('Dance'); -- 29

INSERT INTO ALBUM_ARTISTS(ALBUM_ID,ARTIST_ID) VALUES 
    (1, 2), -- K/DA on All OUT
    (1, 4), -- (G)-IDLE on ALL OUT
    (2, 1), -- TWICE on FOL
    (3, 1), -- TWICE ON B1&2
    (4, 4); -- (G)-IDLE on I NEVER DIE

INSERT INTO SONGS (SONG_NAME, LENGTH, ALBUM_ID, LISTEN_COUNT, RELEASE_DATE)
VALUES
    ('THE BADDEST', 162, 1, 185003069, '2020-08-27'), -- 1
    ('MORE', 217, 1, 218094940, '2020-10-28'), -- 2
    ('VILLAIN', 199, 1, 173026395, '2020-11-06'), -- 3
    ('DRUM GO DUM', 200, 1, 88047040, '2020-11-06'), -- 4
    ('I''LL SHOW YOU', 198, 1, 51136498, '2020-11-06'), -- 5
    ('All The Things She Said', 131, NULL, 22730009, '2020-09-25'), -- 6
    ('Childhood Dreams', 164, NULL, 13875654, '2020-09-25'), -- 7 
    ('SCIENTIST', 194, 2, 127839731, '2021-11-11'), -- 8
    ('MOONLIGHT', 219, 2, 41593771, '2021-11-12'), -- 9
    ('ICON', 176, 2, 34315362, '2021-11-12'), -- 10
    ('CRUEL', 211, 2, 21027812, '2021-11-12'), -- 11
    ('REAL YOU', 187, 2, 14474461, '2021-11-12'), -- 12
    ('F.I.L.A (Fall In Love Again)', 191, 2, 17191763, '2021-11-12'), -- 13
    ('LAST WALTZ', 170, 2, 28032446, '2021-11-12'), -- 14
    ('ESPRESSO', 187, 2, 19458863, '2021-11-12'), -- 15
    ('REWIND', 180, 2, 30664087, '2021-11-12'), -- 16
    ('CACTUS', 217, 2, 14091800, '2021-11-12'), -- 17
    ('PUSH & PULL', 205, 2, 18406951, '2021-11-12'), -- 18
    ('HELLO', 183, 2, 26261476, '2021-11-12'), -- 19
    ('1, 3, 2', 198, 2, 19901224, '2021-11-12'), -- 20
    ('CANDY', 195, 2, 15322769, '2021-11-12'), -- 21
    ('The Feels', 198, 2, 379706820, '2021-09-30'), -- 22
    ('Talk that Talk', 177, 3, 218188031,'2022-08-25'), -- 23
    ('Queen of Hearts', 186, 3, 29630807,'2022-08-26'), -- 24
    ('Basics', 176, 3, 36983308,'2022-08-26'), -- 25
    ('Trouble', 215, 3, 13126774,'2022-08-26'), -- 26
    ('Brave', 189, 3, 17164530,'2022-08-26'), -- 27
    ('Gone', 195, 3, 13183965,'2022-08-26'), -- 28
    ('When We Were Kids', 189, 3, 12621666,'2022-08-26'), -- 29
    ('TOMBOY', 174, 4, 241425409,'2022-03-14'), -- 30
    ('Never Stop me', 144, 4, 14611821,'2022-03-14'), -- 31
    ('VILLAIN DIES', 184, 4, 14768087,'2022-03-14'), -- 32
    ('ALREADY', 201, 4, 8333679,'2022-03-14'), -- 33
    ('POLAROID', 218, 4, 7094622,'2022-03-14'), -- 34
    ('ESCAPE', 209, 4, 10201722,'2022-03-14'), -- 35
    ('LIAR', 171, 4, 7737630,'2022-03-14'), -- 36
    ('MY BAG', 160, 4, 112416106,'2022-03-14'); -- 37

INSERT INTO SONG_ARTISTS (SONG_ID, ARTIST_ID)
VALUES
    -- K/DA
    (1, 2),
    (2, 2),
    (3, 2),
    (4, 2),
    (5, 2),

    -- Seraphine
    (2, 3),  
    (6, 3), 
    (7, 3),

    -- TWICE
    (8, 1),
    (9, 1),
    (10, 1),
    (11, 1),
    (12, 1),
    (13, 1),
    (14, 1),
    (15, 1),
    (16, 1),
    (17, 1),
    (18, 1),
    (19, 1),
    (20, 1),
    (21, 1),
    (22, 1),
    (23, 1),
    (24, 1),
    (25, 1),
    (26, 1),
    (27, 1),
    (28, 1),
    (29, 1),

    -- (G)-IDLE
    (30, 4),
    (31, 4),
    (32, 4),
    (33, 4),
    (34, 4),
    (35, 4),
    (36, 4),
    (37, 4);



INSERT INTO SONG_GENRES(SONG_ID,GENRE_ID) VALUES
    (1,3),
    (1,13),
    (2, 3),
    (3, 4),
    (4, 3),
    (4, 29),
    (5, 4),
    (5, 11),
    (6, 28),
    (7, 4),
    (8, 18),
    (8, 20),
    (9, 17),
    (10, 14),
    (11, 20), 
    (12, 18),
    (12, 20),
    (12, 1),
    (13, 1),
    (13, 18),
    (14, 8),
    (15, 6),
    (15, 7),
    (16, 6),
    (16, 11),
    (17, 27),
    (18, 17),
    (18, 18),
    (19, 13),
    (20, 14),
    (21, 4),
    (22, 17),
    (23, 17),
    (24, 16),
    (25, 19),
    (26, 20),
    (27, 21),
    (28, 21), 
    (28, 22),
    (29, 11),
    (30, 5),
    (30, 23),
    (30, 16),
    (31, 23),
    (32, 22), 
    (33, 24),
    (33, 4),
    (34, 6),
    (35, 11),
    (36, 25),
    (37, 7),
    (37, 26);

INSERT INTO ALBUM_GENRES(ALBUM_ID,GENRE_ID) VALUES
    (1, 3),
    (2, 1),
    (2, 2),
    (3, 3),
    (3, 29),
    (3, 4),
    (3, 16),
    (4, 4),
    (4, 5),
    (4, 6),
    (4, 7);

INSERT INTO USERS (USERNAME, FIRST_NAME, LAST_NAME) 
VALUES 
    ('cuutie', 'Cutie', 'Cherry'), -- 1
    ('streamer', 'Ash', 'Ashington'), -- 2
    ('edgelord', 'Viego', 'Pentakill'); -- 3

INSERT INTO PLAYLISTS (PLAYLIST_AUTHOR, PLAYLIST_NAME, CREATION_DATE)
VALUES  
    (1, 'Current Listens', '2023-06-09'), -- 1
    (1, 'Guilty Pleasures', '2022-01-31'), -- 2
    (3, 'Work Out Tunes', '2023-07-12'), -- 3
    (2, 'Title Tracks Only!!', '2023-11-25'), -- 4
    (3, 'i miss my wife', '2010-01-30'); -- 5

INSERT INTO PLAYLIST_SONGS (PLAYLIST_ID, SONG_ID)
VALUES
    (1, 5), 
    (1, 4),
    (1, 1),
    (2, 2),
    (2, 4),
    (3, 3),
    (3, 22),
    (3, 19),
    (3, 23),
    (4, 2),
    (4, 8),
    (4, 23),
    (4, 30),
    (5, 29),
    (5, 32),
    (5, 35);